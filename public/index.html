<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Android Remote Control Panel</title>
    <style>
        body { 
            background: #121212; 
            color: #e0e0e0; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin: 0;
            padding: 20px;
        }
        h2 { margin-bottom: 10px; color: #00e676; }
        .status { 
            margin-bottom: 20px; 
            padding: 8px 16px; 
            border-radius: 20px; 
            background: #333;
            font-size: 0.9em;
        }
        .online { color: #00e676; border: 1px solid #00e676; }
        .offline { color: #ff5252; border: 1px solid #ff5252; }
        
        /* Canvas mimics phone aspect ratio */
        canvas { 
            border: 2px solid #444; 
            background: #000; 
            max-width: 95vw; 
            max-height: 80vh; 
            cursor: crosshair;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <h2>Remote Controller</h2>
    <div id="stat" class="status offline">Waiting for phone...</div>
    
    <canvas id="screen" width="1080" height="2400"></canvas>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const canvas = document.getElementById('screen');
        const ctx = canvas.getContext('2d');
        const statusDiv = document.getElementById('stat');

        // Identify this connection as the controller
        socket.emit("identify", "controller");

        // Receive the screen frame from the server
        socket.on("display_frame", (data) => {
            statusDiv.innerText = "Device Online";
            statusDiv.className = "status online";
            
            const img = new Image();
            img.onload = () => {
                // Draw the incoming frame onto the canvas
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
            };
            // Use Base64 data received from the phone
            img.src = "data:image/jpeg;base64," + data;
        });

        // Capture clicks and send to server
        canvas.addEventListener('mousedown', (e) => {
            const rect = canvas.getBoundingClientRect();
            
            // Calculate coordinates as percentages (0.0 to 1.0)
            // This ensures the tap lands in the right spot regardless of screen size
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            
            console.log(`Sending tap: X=${x.toFixed(2)}, Y=${y.toFixed(2)}`);
            
            // Emit command to the server
            socket.emit("send_command", { 
                action: "tap", 
                x: x, 
                y: y 
            });
        });

        socket.on('disconnect', () => {
            statusDiv.innerText = "Server Disconnected";
            statusDiv.className = "status offline";
        });
    </script>
</body>
</html>
